{"version":3,"sources":["components/Button/Button.js","components/Broker/Broker-bind.js","mobile/pages/Broker/Broker-bind.js"],"names":["Button","btnText","className","disabled","click","afterClick","checkApprove","wallet","spec","lang","useState","status","setStatus","isApproved","setIsApproved","pending","setPending","loadRef","useRef","onClick","a","beforeAction","afterAction","current","style","display","loadApproveStatus","detail","account","pool","bTokenId","res","approve","success","alert","useEffect","ref","marginRight","inject","observer","address","setAddress","isBind","setIsBind","BindBroker","undefined","bindAddress","toLocaleLowerCase","length","indexOf","setBroker","chainId","console","log","getBroker","path","fetchRestApi","data","type","placeholder","value","onChange","event","target","addressChange","Bind"],"mappings":"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","file":"static/js/22.69277634.chunk.js","sourcesContent":["import {useState,useRef,useEffect} from 'react';\r\nexport default function Button({btnText,className,disabled,click,afterClick,checkApprove,wallet,spec,lang}){\r\n  const [status, setStatus] = useState(disabled ? 'disabled' : 'enabled');\r\n  const [isApproved, setIsApproved] = useState(true);\r\n  const [pending, setPending] = useState(false);\r\n  const loadRef = useRef(null)\r\n\r\n  const onClick = async () => {\r\n    if(status !== 'enabled') {\r\n      return ;\r\n    }\r\n    beforeAction()\r\n    const result = await click();    \r\n    if(result){\r\n      afterClick && afterClick()\r\n    } \r\n    afterAction()\r\n  }\r\n\r\n  const beforeAction = ()  => {\r\n    setStatus('disabled')\r\n    setPending(true);\r\n    loadRef.current && (loadRef.current.style.display = 'inline-block')\r\n  }\r\n\r\n  const afterAction = () => {\r\n    loadRef.current && (loadRef.current.style.display = 'none')\r\n    setStatus('enabled')\r\n    setPending(false);\r\n  }\r\n\r\n  const loadApproveStatus = async () => {\r\n    if(checkApprove && wallet && wallet.detail.account){\r\n      const res = await wallet.isApproved(spec.pool,spec.bTokenId)\r\n      setIsApproved(res);\r\n    }\r\n  }\r\n  const approve = async () => {\r\n    beforeAction();\r\n    const res = await wallet.approve(spec.pool,spec.bTokenId);\r\n    if(res.success){\r\n      setIsApproved(true);\r\n    } else {\r\n      setIsApproved(false)\r\n      alert(lang['approve-failed'])\r\n    }\r\n    afterAction();\r\n  }\r\n\r\n  const action = () => {\r\n    if(isApproved){\r\n      onClick();\r\n    } else {\r\n      approve();\r\n    }\r\n  }\r\n\r\n  useEffect(() => {\r\n    loadApproveStatus();\r\n    return () => {};\r\n  }, [wallet,spec,checkApprove]);\r\n\r\n  return(\r\n    <button className={className} onClick={action} >\r\n        <span className='btn-loading-wrap'>\r\n          <span ref={loadRef}\r\n            className='spinner spinner-border spinner-border-sm'\r\n            style={{display : 'none' ,marginRight : '2'}}>\r\n          </span>\r\n        </span>\r\n          {pending ? lang['pending'] : (isApproved ? btnText : lang['approve'])  }\r\n        </button>\r\n  )\r\n}","import React,{useState,useEffect} from 'react'\r\nimport {inject,observer} from 'mobx-react'\r\nimport Button from '../Button/Button';\r\nimport {\r\n  fetchRestApi,\r\n  setBroker,\r\n} from \"../../lib/web3js/indexV2\";\r\nfunction Bind({wallet={},lang}){\r\n  const [address,setAddress] = useState()\r\n  const [isBind,setIsBind] = useState(true)\r\n  \r\n  const hasConnectWallet = () => wallet && wallet.detail && wallet.detail.account\r\n\r\n  const BindBroker = async ()=>{\r\n    if( hasConnectWallet()){\r\n      if(address === undefined){\r\n        alert(lang['please-enter-address']) \r\n        return;\r\n      }\r\n      let bindAddress = address.toLocaleLowerCase();\r\n      if(bindAddress.length != 42 || bindAddress.indexOf('0x') != 0){\r\n        alert(lang['please-enter-a-correct-address']) \r\n        return;\r\n      }\r\n      if(bindAddress === wallet.detail.account){\r\n        alert(lang['brokder-addr-cannot-be-the-same-as-trader']) \r\n        return;\r\n      }\r\n      if(isBind){\r\n        alert(lang['cannot-bind-twice']) \r\n        return;\r\n      }\r\n      let res = await setBroker(wallet.detail.chainId,wallet.detail.account,address)\r\n      console.log(res)\r\n      if(!res.success){\r\n        alert(lang['bind-faild'])\r\n      }\r\n      if(res.success){\r\n        setIsBind(true)\r\n      }\r\n    }\r\n  }\r\n\r\n  const getBroker = async() =>{\r\n    let path = `/broker/${wallet.detail.account}/get_broker`\r\n    let res =  await fetchRestApi(path)\r\n    if(res.data){\r\n      if(res.data.length){\r\n        setIsBind(true)\r\n      }else{\r\n        setIsBind(false)\r\n      }\r\n    }else{\r\n      setIsBind(false)\r\n    }\r\n  }\r\n\r\n  const addressChange = event =>{\r\n    let {value} = event.target\r\n    setAddress(value)\r\n  }\r\n  useEffect(()=>{\r\n    getBroker();\r\n  },[wallet.detail])\r\n  return(\r\n    <div className='broker-bind'>\r\n      <div className='header'>\r\n        {lang['brokers-address']}\r\n      </div>\r\n      <div className='bind-input'>\r\n        <div className='address'>\r\n          <input className='address-input' type='text'\r\n          placeholder={lang['address']}\r\n          value={address}   \r\n          onChange={event =>  addressChange(event) }\r\n          />\r\n        </div>\r\n        <div className='bind-button'>\r\n          <Button className='btn' btnText={lang['bind']} lang={lang} click={BindBroker} />\r\n        </div>\r\n      </div>\r\n    </div>\r\n  )\r\n}\r\nexport default inject('wallet')(observer(Bind))","import BrokerBind from '../../../components/Broker/Broker-bind'\r\nimport \"./Bind.less\"\r\nexport default function Bind({lang}){\r\n  return (\r\n    <BrokerBind lang={lang}/>\r\n  )\r\n}"],"sourceRoot":""}